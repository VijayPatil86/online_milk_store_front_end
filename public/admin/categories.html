<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Online Store</title>
<script type="text/javascript">
	function set_HATEOAS_links() {
		var xhttp = new XMLHttpRequest();
		xhttp.open("GET", "http://localhost:9001/categories/get_HATEOAS_links");
		xhttp.send();
		xhttp.onload = function() {
			var response = JSON.parse(this.responseText);
		    document.getElementById("a_GetAllAvailableCategories").href = 
		    	response._links.link_getAllAvailableCategories.href;
		}
	}
	function setElements() {
		document.getElementById("a_GetAllAvailableCategories").addEventListener("click", function(event){
			event.preventDefault()
		});
	}
	function getAllAvailableCategories(anchor) {
		var link_getAllAvailableCategories = anchor.href;
		var xhttp = new XMLHttpRequest();
		xhttp.open("GET", link_getAllAvailableCategories);  
		xhttp.send();
		xhttp.onload = function() {
			if(xhttp.status == 200){
				var response = JSON.parse(this.responseText);
				var categories = response.categoryBeans;
				document.getElementById("div_CategoriesList").innerHTML = "";
				document.getElementById("lblCategoriesNotAvailable").style.display = "none";
				var html_table = "<table>";
				for(var index=0; index < categories.length; index++){
					var category = categories[index];
					var categoryName = category.categoryName;
					
					html_table = html_table + "<tr>";
					var style_padding_left = "\"padding-left: 100px;\"";
					html_table = html_table + "<td>" + categoryName + "</td>";
					var link_getCategoryById = category._links.link_getCategoryById.href;
					var onclickFunction = "alert('Category Details: " + JSON.stringify(category) + "'); return false;";
					var anchor_start = "<a href=\"" +link_getCategoryById + "\"" +  
						" onclick=" + onclickFunction +
						">";
					var anchor_end = "</a>";
					html_table = html_table + "<td style=" +style_padding_left + ">" + 
						"<label style=\"text-decoration: underline;color: blue;\"" +
						" onclick=\"" + onclickFunction + "\"" + 
						">" + 
						"Get Details" + 
						"</label>" + 
						"</td>";
					html_table = html_table + "</tr>"
				}
				html_table = html_table + "</table>";
				document.getElementById("div_CategoriesList").innerHTML = html_table;
			}
		    if(xhttp.status == 204) {
		    	document.getElementById("div_CategoriesList").innerHTML = "";
		    	document.getElementById("lblCategoriesNotAvailable").style.display = "block";
		    }
		}
	}
	function addCategory() {
		var categoryName = document.getElementById("txtCategoryName").value;
		var json_CategoryName = JSON.stringify({ categoryName: categoryName });
		var xhttp = new XMLHttpRequest();
		xhttp.open("POST", "http://localhost:9001/categories");
		xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
		xhttp.send(json_CategoryName);
		xhttp.onload = function() {
	    	if(xhttp.status == 200){
	    		alert("Category added successfully.");
	    	}
	  	}
	}
</script>
</head>
<body onload="set_HATEOAS_links(); setElements();">
	<H1>Online Store</H1>
	<div id="divCategories"></div>
	<H3>Add Category</H3>
	<form id="form_add_category">
		<label>Category Name:</label>
		<input type="text" id="txtCategoryName">
		<br><br>
		<input type="button" value="Add Category" onclick="addCategory()">
		<br><br>
		<hr>
		<H3>Categories:</H3>
		<p style="margin-top: -38px; margin-left: 115px;">
			<a id="a_GetAllAvailableCategories" onclick="getAllAvailableCategories(this)">Get All Available Categories</a>
		</p>
		<label id="lblCategoriesNotAvailable" style="display: none;">Categories not available</label>
		<div id="div_CategoriesList"></div>
	</form>
</body>
</html>